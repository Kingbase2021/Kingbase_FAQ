License 相关
==============================

如何查询license有效时间
-----------------------------------

适用版本：V8R3 , V8R6

.. code::

  TEST=# selectget_license_validdays ();                                                                                                     
   GET_LICENSE_VALIDDAYS                                                                                                                    
  -----------------------                                                                      
   24                                                                                                                                       
  (1 row)                                                               

SELECT get_license_validdays();   如果返回值为 -2 ，表示永久license



如何查询license完整信息
-----------------------------------

适用版本：V8R3

+-----------------------------------------------------------------------+
| TEST=# select get_license_info();                                     |
|                                                                       |
|                         GET_LICENSE_INFO                              |
|                                                                       |
| -----------------------------------------------------------------     |
|                                                                       |
|  License序列号 --- 启用 --- 6AB57220-864E-11EA-AA4F-000C2937A8A8+     |
|                                                                       |
|  生产日期 --- 启用 --- 2020-04-25                               +     |
|                                                                       |
|  产品名称 --- 启用 --- KingbaseES V8                            +     |
|                                                                       |
|  细分版本模板名 --- 启用 --- TEST人大金仓内部测试               +     |
|                                                                       |
|  产品版本号 --- 启用 --- V008R003                               +     |
|                                                                       |
|  浮动基准日期 ------ 启用                                       +     |
|                                                                       |
|  有效期间 --- 启用 --- 30                                       +     |
|                                                                       |
|  CPU检查 --- 启用 --- 0                                         +     |
|                                                                       |
|  MAC地址 --- 启用 --- 00:00:00:00:00:00                         +     |
|                                                                       |
|  最大连接数 --- 启用 --- 0                                      +     |
|                                                                       |
|  数据同步 --- 启用 --- 0                                        +     |
|                                                                       |
|  物理同步 --- 启用 --- 0                                        +     |
|                                                                       |
|  增量备份恢复 --- 启用 --- 0                                    +     |
|                                                                       |
|  集群对网络故障的容错 --- 启用 --- 0                            +     |
|                                                                       |
|  集群配置工具 --- 启用 --- 0                                    +     |
|                                                                       |
|  读写分离模块 --- 启用 --- 0                                    +     |
|                                                                       |
|  保密通讯协议 --- 启用 --- 0                                    +     |
|                                                                       |
|  审计 --- 启用 --- 0                                            +     |
|                                                                       |
|  三权分立 --- 启用 --- 0                                        +     |
|                                                                       |
|  密码复杂度 --- 启用 --- 0                                      +     |
|                                                                       |
|  用户锁定 --- 启用 --- 0                                        +     |
|                                                                       |
|  运行状态分析 --- 启用 --- 0                                    +     |
|                                                                       |
|  滚动升级 --- 启用 --- 0                                        +     |
|                                                                       |
|  恢复到指定时间点 --- 启用 --- 0                                +     |
|                                                                       |
|  快速加载 --- 启用 --- 0                                        +     |
|                                                                       |
|  日志压缩 --- 启用 --- 0                                        +     |
|                                                                       |
|  全文检索 --- 启用 --- 0                                        +     |
|                                                                       |
|  健康检查 --- 启用 --- 0                                        +     |
|                                                                       |
|  并行查询 --- 启用 --- 0                                        +     |
|                                                                       |
|  并行备份还原 --- 启用 --- 0                                    +     |
|                                                                       |
|  日志解析 --- 启用 --- 0                                        +     |
|                                                                       |
|  异构数据源 --- 启用 --- 0                                      +     |
|                                                                       |
|  透明加密 --- 启用 --- 0                                        +     |
|                                                                       |
|  强制访问控制 --- 启用 --- 0                                    +     |
|                                                                       |
|                                                                       |
|                                                                       |
| (1 row)                                                               |
+-----------------------------------------------------------------------+

.. NOTE::

   V8R6 没有该函数




如何查询license单项信息
-----------------------------------

适用版本：V8R3

+-----------------------------------------------------------------------+
| TEST=# select \* from substring(get_license_info() ,                  |
| instr(get_license_info(), 'MAC地址'),                                 |
|                                                                       |
| instr(get_license_info(), '最大连接') - instr(get_license_info(),     |
| 'MAC地址') - 1);                                                      |
|                                                                       |
|                SUBSTRING                                              |
|                                                                       |
| ----------------------------------------                              |
|                                                                       |
|  MAC地址 --- 启用 --- 00:00:00:00:00:00                               |
|                                                                       |
| (1 row)                                                               |
+-----------------------------------------------------------------------+



替换license步骤
-----------------------------------

适用版本：V8R3 ，V8R6

替换过程：

   第一步，登录服务器，执行：find -name license.dat，看license.dat在哪些路径。

   第二步：把上一步找到的路径记录下来。

   第三步，根据上一步的路径把原有license.dat重命名为license.dat_old或者其他名字

   第四步：把新的license.dat传到服务器，重命名为license.dat，并且执行chown -R kingabse:kingbase license.dat（用什么用户安装的用户权限给到哪个用户）

   第五步，执行su -kingbase切换到kingbase用户，把最新的license拷贝到第二步记录下来的路径。

   最后一步：重启数据库：sys_ctl restart -D /home/kingbase/KingbaseES/V8/data(备注：每个地方data路径可能不一样，通过ps -ef查找出带-D的进程，确定准确的data路径)




替换license是否要重启数据库
-----------------------------------

适用版本：V8R3, V8R6

问题描述：如题

问题解决：可以不必重启数据库，可以在任一system用户连接上执行select sys_reload_conf()，退出重登录后就可以看到变更生效。或者kill -1 kingbase主进程号的方式，也可以重新加载license信息。



如何判断license有效
-----------------------------------

适用版本：V8R3 , V8R6

问题描述：替换了license 后还是显示授权过期，更换另一个license就正常。

更换的license 需要比较以下几点：

   1、 版本是否相同，包括：产品版本号、细分版本模板名。不同版本license不通用。

   2、 数据库key值。如果换了license，但key值还是与原来相同，实际是同一个license文件，也就是实际没换。

   3、 如果“浮动基准日期”是禁用的状态，到期日是“生产日期”+“有效期间”。如果“浮动基准日期”是启用的，到期日是license更换日期 +“有效期间”。

   4、 License 例子如下：

   .. figure:: images/FAQ24011.png
      :width: 556px
      :height: 518px

 

License与网卡
-----------------------------------

适用版本：V8R3

问题描述：为什么部分R3版本无法识别bond开始的网卡？

问题解析：V8R3 B0261版本解决了网卡问题，可以识别所有网卡，而之前的版本只能识别e开头（不仅是eth开头的）的网卡。


Bond网卡切换license支持问题
-----------------------------------

适用版本：V8R3 , V8R6新版本

问题描述：

问题分析：早期的license只提供一个license，如果网卡切换或者网卡更换